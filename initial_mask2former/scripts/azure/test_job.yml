$schema: https://azuremlschemas.azureedge.net/latest/commandJob.schema.json

display_name: mask2former-test-evaluation
experiment_name: mask2former_tfm_test
compute: azureml:MODELTRAINING

inputs:
  test_dataset:
    type: uri_folder
    path: azureml:DATASET_custom_roadaidefects_mmseg@latest # Your test split
    mode: ro_mount
  # POINT TO YOUR BEST CHECKPOINT FROM THE PREVIOUS RUN
  trained_checkpoint_dir:
    type: uri_folder
    path: azureml://datastores/workspaceblobstore/paths/checkpoints/mask2former_swing_tiny/
    mode: ro_mount

outputs:
  test_results:
    type: uri_folder
    path: azureml://datastores/workspaceblobstore/paths/test_results/mask2former_v1
    mode: rw_mount

code: "../../" # Uploads configs/ and scripts/

command: >-
  python scripts/mim_test_executer.py 
  --config configs/cracks_augmentation.py 
  --work_dir ${{inputs.trained_checkpoints_dir}}
  --data_root ${{inputs.test_dataset}}
  --out_dir ${{outputs.test_results}}

environment:
  image: crflowityartifacts.azurecr.io/roadai/laura_tfm:mask2formerSwing